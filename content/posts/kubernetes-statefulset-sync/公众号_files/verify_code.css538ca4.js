"use strict"
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}
!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define?define("3rd/mplogd/mplogd.js",[],e):(t=t||self).Mplogd=e()}(void 0,function(){var r="initing",i="inited",c="failed",h=0,l=1,a=2,d=3,o="info",n="warn",s="error",u=["mplog","report","webcommreport"]
function p(t){return(t=t.toString())[1]?t:"0"+t}function f(t){var e=""
return/^[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(t)?e+=new Date(t).getTime():/^\d{13}$/.test(t)?e+=t:/^\d{10}$/.test(t)&&(e+=1e3*parseInt(t,10)),parseInt(e,10)}function g(i,a,s,u){return new(s=s||Promise)(function(t,e){function r(t){try{n(u.next(t))}catch(t){e(t)}}function o(t){try{n(u.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(r,o)}n((u=u.apply(i,a||[])).next())})}function w(r,o){var n,i,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1]
return a[1]},trys:[],ops:[]}
return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t
function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.")
for(;s;)try{if(n=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a
switch(i=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e
break
case 4:return s.label++,{value:e[1],done:!1}
case 5:s.label++,i=e[1],e=[0]
continue
case 7:e=s.ops.pop(),s.trys.pop()
continue
default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0
continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1]
break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e
break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e)
break}a[2]&&s.ops.pop(),s.trys.pop()
continue}e=o.call(r,s)}catch(t){e=[6,t],i=0}finally{n=a=0}if(5&e[0])throw e[1]
return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function m(o){return void 0===o&&(o=1e8),g(this,void 0,void 0,function(){return w(this,function(t){try{return window.navigator&&window.navigator.storage&&window.navigator.storage.estimate?[2,window.navigator.storage.estimate().then(function(t){var e=t.quota,r=t.usage
return e<=r||o<=r})]:window.navigator&&window.navigator.webkitTemporaryStorage&&window.navigator.webkitTemporaryStorage.queryUsageAndQuota?[2,new Promise(function(r){window.navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,e){r(e<t||o<=t)})})]:[2,!1]}catch(t){return[2,!1]}return[2]})})}function y(){return g(this,void 0,void 0,function(){return w(this,function(t){try{return window.navigator&&window.navigator.storage&&window.navigator.storage.estimate?[2,window.navigator.storage.estimate().then(function(t){return t.usage})]:window.navigator&&window.navigator.webkitTemporaryStorage&&window.navigator.webkitTemporaryStorage.queryUsageAndQuota?[2,new Promise(function(e){window.navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t){e(t)})})]:[2,0]}catch(t){return[2,0]}return[2]})})}var v=!!window.navigator.userAgent.match(/QQBrowser\/(\d+\.\d+)/i),b=!!window.navigator.userAgent.match(/Firefox\/(\d+\.\d+)/i),E=(window.navigator.userAgent.match(/MetaSr\/(\d+\.\d+)/i),/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),x="readwrite",B=["enough space","full disk","Maximum key generator","large IndexedDB value"]
var e=(t.prototype.insertItems=function(u){return g(this,void 0,void 0,function(){var e,r,o,n,i,a,s=this
return w(this,function(t){switch(t.label){case 0:return[4,y()]
case 1:if(2e9<t.sent())return this.throwError(h,"larger than 2000MB"),this.clean(),[2]
if(null===(r=this.getTransaction(x)))return this.throwError(d,"transaction is null"),[2,!1]
for(o=r.objectStore(this.DB_STORE_NAME),n=0,i=u;n<i.length;n++)a=i[n],(e=o.put(a)).onsuccess=function(){},e.onerror=function(t){return s.checkDB(t),s.throwError(l,"add log failed",t.target.error)}
return this.checkCurrentStorage(),[2]}})})},t.prototype.get=function(t,e,r,o){var n=this.getTransaction(x)
if(null===n)return this.throwError(d,"transaction is null"),!1
var i=(new Date).getTime(),a=(new Date).getTime()
try{i=f(t),a=f(e)}catch(t){this.throwError(l,"invalid time")}var s=n.objectStore(this.DB_STORE_NAME),u=[],c=IDBKeyRange.bound(i,a),h=s.index("timestamp").openCursor(c)
return"function"==typeof o?h.onsuccess=function(t){o(t)}:"function"==typeof r&&(h.onsuccess=function(t){var e=t.target.result
e?(u.push({time:e.value.time,level:e.value.level,location:e.value.location,description:e.value.description,data:e.value.data,timestamp:e.value.timestamp}),e.continue()):r(u)}),!0},t.prototype.delete=function(){return g(this,void 0,void 0,function(){var e,r
return w(this,function(t){if(!v&&!b){this.dbStatus=c,this.currentRetryCount=this.maxRetryCount+1,this.indexedDB.deleteDatabase(this.DB_NAME),e=[3098987299,3239847736,3551983495,3549047295,3586295061,3006274708,3269640101,3266552330,2395667878,3554976120,3297568903,3223689247,3578378399,3089724247,3545903934,3272891096,3283924473,3270637404,3546480740,3203066997,3580377525,3893104532,3292955980,3925196695,3258438094,2392720325,3573889771,3588801455,3523511770,3208017153,3598934044,3295015455,3553864193,3529838982,3075298111,3556610385,3070904661,3233812476,3083566301,3861549671,3283784527,3932026776,3007617172,3880435175,3885547665,3291578590,3201318251,3865364711,3512983321,3529333012,3070332279,3907160931,3574918287,3275780384,3887160995,3903157214,3297157474,3941145098,3090768813,3088583289,3554902655]
try{r=this.DB_NAME.replace("mplog__","").replace("mpcache__",""),-1<e.indexOf(parseInt(r,10))&&this.throwError(h,"delete count0 database is "+this.DB_NAME)}catch(t){console.log(t)}this.throwError(h,"delete count0 database")}return[2]})})},t.prototype.clean=function(){return g(this,void 0,void 0,function(){var e,s,r,o=this
return w(this,function(t){if(this.cleaning)return[2]
if(null===(e=this.getTransaction(x)))return this.throwError(d,"transaction is null"),[2]
try{this.throwError(h,"begin clean database"),s=e.objectStore(this.DB_STORE_NAME),(r=s.openCursor()).onsuccess=function(t){var e=t.target.result
if(!e){var r=s.count()
r.onsuccess=function(){return g(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.throwError(h,"begin clean no result"+r.result),[4,this.delete()]
case 1:return t.sent(),[2]}})})}}if(e&&e.primaryKey){o.cleaning=!0
var i=e.primaryKey,a=s.count()
a.onsuccess=function(){return g(o,void 0,void 0,function(){var e,r,o,n=this
return w(this,function(t){switch(t.label){case 0:return(e=a.result)<50?[4,this.delete()]:[3,2]
case 1:return t.sent(),[2]
case 2:return r=i+Math.ceil(e/5),(o=s.delete(IDBKeyRange.bound(i,r,!1,!1))).onsuccess=function(){n.throwError(h,"clean database success"),n.cleaning=!1},o.onerror=function(t){n.throwError(d,"clean database error",t.target.error)},[2]}})})},a.onerror=function(t){o.throwError(d,"clean database error count error",t.target.error)}}},r.onerror=function(t){o.throwError(d,"clean database error open cursor error",t.target.error)}}catch(t){this.throwError(h,"clean database error",t)}return[2]})})},t.prototype.keep=function(o){var n=this,t=this.getTransaction(x)
if(null!==t)if(o)try{var c=t.objectStore(this.DB_STORE_NAME)
c.openCursor().onsuccess=function(t){var e=t.target.result
if(e&&e.primaryKey){var a=e.primaryKey,s=e.value.timestamp,u=Date.now()-60*o*60*24*1e3,r=IDBKeyRange.lowerBound(u,!0)
c.indexNames&&c.indexNames.length&&c.indexNames.contains("timestamp")&&(c.index("timestamp").openKeyCursor(r).onsuccess=function(i){return g(n,void 0,void 0,function(){var e,r,o,n=this
return w(this,function(t){switch(t.label){case 0:return i.target&&i.target.result?(e=i.target.result.primaryKey,a!==e?[3,3]:s<u&&E?[4,this.delete()]:[3,2]):[3,4]
case 1:t.sent(),t.label=2
case 2:return[2]
case 3:return(r=c.delete(IDBKeyRange.bound(a,e,!1,!0))).onsuccess=function(){n.throwError(h,"keep logs success")},r.onerror=function(t){n.throwError(d,"keep logs error",t.target.error)},[3,5]
case 4:(o=c.count()).onsuccess=function(){var t=o.result,e=a+t,r=c.delete(IDBKeyRange.bound(a,e,!1,!1))
r.onsuccess=function(){n.throwError(h,"keep logs success")},r.onerror=function(t){n.throwError(d,"keep logs error",t.target.error)}},t.label=5
case 5:return[2]}})})})}}}catch(t){console.log(t)}else t.objectStore(this.DB_STORE_NAME).clear().onerror=function(t){return n.throwError(a,"indexedb_keep_clear",t.target.error)}
else this.throwError(d,"transaction is null")},t.prototype.throwError=function(t,e,r){var o=this
this.currentErrorNum+=t,this.currentErrorNum>=this.maxErrorNum&&(this.dbStatus=c,this.poolHandler.pool=[],this.currentErrorNum=0)
var n,i,a,s=""
r&&(e=e+":"+(r.message||r.stack||r.name),s=r.toString())
try{if(this.BadJsReport){var u="Mplog: error msg: "+e+", error detail: "+s
this.BadJsReport(e,u)}}catch(t){}n=s||e,a=!1,(i=B).length&&i.forEach(function(t){-1<n.indexOf(t)&&(a=!0)}),a?this.clean():this.dbStatus===c&&!this.timer&&0<t&&(this.timer=setInterval(function(){o.retryDBConnection()},this.retryInterval))},t.prototype.retryDBConnection=function(){this.currentRetryCount+=1,this.currentRetryCount>this.maxRetryCount?(this.dbStatus=c,this.poolHandler.pool=[]):(this.dbStatus=r,this.createDB()),clearInterval(this.timer)},t.prototype.init=function(){return g(this,void 0,void 0,function(){var e
return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),[4,m()]
case 1:return t.sent()?(this.throwError(h,"this db size is too large"),[4,y()]):[3,3]
case 2:return(e=t.sent())&&0<e&&(100<(e=Math.ceil(e/1e6))&&e<=200?this.throwError(h,"100MB - 200MB"):200<e&&e<=300?this.throwError(h,"200MB - 300MB"):300<e&&e<=400?this.throwError(h,"300MB - 400MB"):400<e&&e<=500?this.throwError(h,"400MB - 500MB"):500<e&&e<=600?this.throwError(h,"500MB - 600MB"):600<e&&e<=1e3?this.throwError(h,"600MB - 1000MB"):this.throwError(h,"larger than 1000MB")),[3,4]
case 3:this.throwError(h,"this db size is lower than 100MB"),t.label=4
case 4:return this.createDB(),[3,6]
case 5:return t.sent(),console.log("Mplog createDB failed"),[3,6]
case 6:return[2]}})})},t.prototype.createDB=function(){return g(this,void 0,void 0,function(){var e,n=this
return w(this,function(t){return this.indexedDB?this.dbStatus!==r?(this.currentRetryCount=this.maxRetryCount+1,this.throwError(d,"indexedDB init error")):(window&&window.navigator&&window.navigator.storage||window&&window.navigator&&window.navigator.webkitTemporaryStorage?this.throwError(h,"user support storage calculation"):this.throwError(h,"user does not support storage calculation"),(e=indexedDB.open(this.DB_NAME,this.DB_VERSION)).onerror=function(t){n.checkDB(t)
var e=a
if(t.target.error&&"VersionError"===t.target.error.name){try{var r=t.target.error.message
if(-1<r.search(/The requested version \([0-9]+\) is less than the existing version \([0-9]\)/)){var o=r.match(/[0-9]+/gi)[1]
o>n.DB_VERSION&&(n.DB_VERSION=o)}}catch(t){console.log(t)}e=d,n.dbStatus=c}n.throwError(e,"indexedDB open error",t.target.error)},e.onsuccess=function(t){if(n.dbStatus===r){n.timer&&clearInterval(n.timer),n.db=t.target.result,n.dbStatus=i,n.db.onerror=function(t){return n.throwError(a,"indexedDB error",t.target.error)},n.db.onversionchange=function(t){n.db.close(),n.dbStatus=c,n.currentRetryCount=n.maxRetryCount+1,n.throwError(d,"indexedDB version change",t.target.error)}
try{n.poolHandler.consume()}catch(t){n.throwError(d,"consume pool error",t)}n.keep7Days&&setTimeout(function(){n.dbStatus!==i?n.poolHandler.push(function(){return n.keep(7)}):n.keep(7)},1e3)}},e.onblocked=function(){n.throwError(a,"indexedDB is blocked")},e.onupgradeneeded=function(t){n.db=t.target.result
try{"function"==typeof n.onupgradeneeded?n.onupgradeneeded(t):n.db.objectStoreNames.contains(n.DB_STORE_NAME)||n.db.createObjectStore(n.DB_STORE_NAME,{autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1})}catch(t){n.dbStatus=c,n.throwError(d,"indexedDB upgrade error",t)}}):(this.currentRetryCount=this.maxRetryCount+1,this.throwError(d,"your browser not support IndexedDB.")),[2]})})},t.prototype.checkCurrentStorage=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,m(5e7)]
case 1:return t.sent()?(this.clean(),[2,!0]):[2,!1]}})})},t.prototype.checkDB=function(t){t&&t.target&&t.target.error&&"QuotaExceededError"===t.target.error.name&&this.clean()},t.prototype.getTransaction=function(t){var e=this,r=null
if(this.dbStatus===c)r=null
else{try{r=this.db.transaction(this.DB_STORE_NAME,t)}catch(t){r=null}r&&(r.onerror=function(t){return t.stopPropagation(),e.throwError(d,"transaction is error")},r.onabort=function(t){t.stopPropagation(),e.checkDB(t)})}return r},t)
function t(t,e){this.defaultDbName="mplog",this.defaultDbStoreName="logs",this.dbStatus=r,this.currentErrorNum=0,this.maxRetryCount=3,this.currentRetryCount=0,this.retryInterval=1e4,this.DB_NAME=t&&t.dbName?t.dbName:this.defaultDbName,this.DB_STORE_NAME=t&&t.dbStoreName?t.dbStoreName:this.defaultDbStoreName,this.DB_VERSION=t&&void 0!==t.dbVersion?t.dbVersion:6,this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,this.onupgradeneeded=t&&t.onupgradeneeded?t.onupgradeneeded:null,this.maxErrorNum=t&&t.maxErrorNum?t.maxErrorNum:3,this.poolHandler=e,this.keep7Days=!t||!t.keep7Days||t.keep7Days,this.BadJsReport=t&&t.BadJsReport?t.BadJsReport:null,this.init()}var D=(S.prototype.push=function(t){this.pool.length<this.poolSize&&this.pool.push(t)},S.prototype.consume=function(){for(var t=this.pool.shift();t;)t(),t=this.pool.shift()},S)
function S(){this.poolSize=20,this.pool=[]}var R=(M.prototype.log=function(t,e,r,o){var n,i,a,s,u,c,h,l=new Date,d={time:(i=(n=l).getFullYear(),a=n.getMonth()+1,s=n.getDate(),u=n.getHours(),c=n.getMinutes(),h=n.getSeconds(),[i,a,s].map(p).join("-")+" "+[u,c,h].map(p).join(":")),location:t,level:e,description:r,data:this.dealLength(this.filterFunction(o)),timestamp:l.getTime()}
this.bufferLog.push(d),this.bufferLog.length>=this.bufferSize&&(this.flush(this.bufferLog),this.bufferLog=[])},M.prototype.flush=function(t){var e=this
return void 0===t&&(t=this.bufferLog),!(!t||0===t.length)&&(this.reportFunction&&this.reportFunction(t),this.mpIndexedDB.dbStatus!==i?this.poolHandler.push(function(){return e.flush(t)}):(this.mpIndexedDB.insertItems(t),0))},M.prototype.get=function(t,e,r,o){var n=this
if(this.mpIndexedDB.dbStatus!==i)return this.poolHandler.push(function(){return n.get(t,e,r,o)})
this.mpIndexedDB.get(t,e,r,o)},M.prototype.keep=function(t){var e=this
if(this.mpIndexedDB.dbStatus!==i)return this.poolHandler.push(function(){return e.keep(t)})
this.mpIndexedDB.keep(t)},M.prototype.clean=function(){var t=this
if(this.mpIndexedDB.dbStatus!==i)return this.poolHandler.push(function(){return t.clean()})
this.mpIndexedDB.clean()},M.prototype.dealLength=function(t){return"number"==typeof this.maxLogSize&&"string"==typeof t&&t.length>=this.maxLogSize&&(t=t.substr(0,this.maxLogSize)),t},M.prototype.filterFunction=function(t){try{return"number"==typeof t||"boolean"==typeof t?""+t:"string"==typeof t?t:""}catch(t){console.log(t)}},M)
function M(t){this.bufferLog=[],this.bufferSize=t&&void 0!==t.bufferSize?+t.bufferSize:10,this.maxLogSize=t&&t.maxLogSize?t.maxLogSize:3e3,this.reportFunction=t&&t.reportFunction,this.poolHandler=new D,this.mpIndexedDB=new e(t,this.poolHandler)}function k(t){this.xhrOpen=XMLHttpRequest.prototype.open,this.xhrSend=XMLHttpRequest.prototype.send,this.defaultAjaxFilter=function(t){return-1===u.indexOf(((e=t).match(/\/[A-Za-z]+\?/)&&(r=(r=e.match(/\/[A-Za-z]+\?/)[0]).replace("?","").replace("/","")),r))
var e,r},this.location=t&&t.location?t.location:window.location.href,this.autoLogError=!(!t||void 0===t.autoLogError)&&t.autoLogError,this.autoLogRejection=!(!t||void 0===t.autoLogRejection)&&t.autoLogRejection,this.autoLogAjax=!(!t||void 0===t.autoLogAjax)&&t.autoLogAjax,this.logAjaxFilter=t&&t.logAjaxFilter?t.logAjaxFilter:this.defaultAjaxFilter,this.logController=new R(t),this.bindEvent()}return k.prototype.info=function(t,e){this.logController.log(this.location,o,t,e)},k.prototype.warn=function(t,e){this.logController.log(this.location,n,t,e)},k.prototype.error=function(t,e){this.logController.log(this.location,s,t,e)},k.prototype.get=function(t,e,r,o){this.logController.get(t,e,r,o)},k.prototype.keep=function(t){this.logController.keep(t)},k.prototype.clean=function(){this.logController.clean()},k.prototype.bindEvent=function(){var e=this
this.autoLogError&&window.addEventListener("error",function(t){e.error("[OnError]: "+t.message,"("+t.lineno+'_("行")'+t.colno+'_("列"))')}),this.autoLogRejection&&window.addEventListener("unhandledrejection",function(t){e.error("[OnRejection]:",t.reason)}),this.ajaxHanler(),this.saveUnstoreData()},k.prototype.ajaxHanler=function(){if(this.autoLogAjax){var s,u,c=this
XMLHttpRequest.prototype.open=function(){for(var t,e,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o]
s=r[0],t=r[1],(e=document.createElement("a")).href=t,u=e.protocol+"//"+e.host+e.pathname+e.search+e.hash,c.xhrOpen.apply(this,r)},XMLHttpRequest.prototype.send=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t]
var o=(new Date).getTime(),n=+new Date,i=u,a=s
if(c.logAjaxFilter&&c.logAjaxFilter(u,s)||!c.logAjaxFilter){var e="[ajax] id:"+n+" request "+u+" "+s
"post"===s.toLowerCase()?c.info(e,r[0]):c.info(e)}this.addEventListener("readystatechange",function(){var e=""
if(c.logAjaxFilter&&c.logAjaxFilter(i,a)||!c.logAjaxFilter)try{if(this.readyState===XMLHttpRequest.DONE){var t=((new Date).getTime()-o)/1e3
c.info("[ajax] id:"+n+" response "+this.status+" "+i+" "+t,this.responseText)}}catch(t){e="[ajax] id:"+n+" response "+this.status+" "+i,"post"===s.toLowerCase()?c.error(e,r[0]):c.error(e)}}),c.xhrSend.apply(this,r)}}},k.prototype.saveUnstoreData=function(){var t=this
window.addEventListener("beforeunload",function(){try{t.logController.flush()}catch(t){console.log(t)}return null})},k})
"use strict"
define("pages/modules/mplog/uplog.js",["3rd/mplogd/mplogd.js","pages/modules/utils/cgi.js","pages/modules/mplog/notify.js"],function(e,t,a){var n=e("3rd/mplogd/mplogd.js"),d=e("pages/modules/utils/cgi.js"),m=e("pages/modules/mplog/notify.js"),o="mplog__"+wx.uin,l="logs",i=window.wx.commonData.mplog,r=i.needUplog,s=void 0!==r&&r,u=i.beginTime,p=void 0===u?0:u,g=i.endTime,f=void 0===g?0:g,c=i.uploadCGIName,v=void 0===c?"":c,y=v.split(","),h=["info","error","warn"],w={unload:"未上传",loading:"上传中",loaded:"已上传",failed:"上传失败"},_=2,b=18e5,T=1e6,x=[[]],O=null,S=1,j=[]
function N(){return!(!i||!s)&&!(!p||!f||f<=p)}function J(e){var t=""
return e.match(/\/[A-Za-z]+\?/)&&(t=(t=e.match(/\/[A-Za-z]+\?/)[0]).replace("?","").replace("/","")),t}function D(e){return function(e){if(!v||""===v)return!0
var t=J(e.value.location)
return!!(t&&-1<y.indexOf(t))}(e)}function I(i,n){O.get(p,f,null,function(e){var t=e.target.result
if(t){if(function(e,t){var a=!0,i=!1,n=void 0
try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){if(o.value.id===t)return 1}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}}(i,t.primaryKey)){var a=t.value
a.status=n,a.statusChangeTime=(new Date).getTime(),n===w.failed&&(a.failTimes=a.failTimes?++a.failTimes:1),t.update(a)}t.continue()}})}function M(){if(1!==x.length||0!==x[0].length)for(var l=0,r=x.length,s=[],e=function(e){I(x[e],w.loading),s=x[e]
for(var t=[],a=0;a<x[e].length;a++){var i=x[e][a]
t.push({interface:"mp_log",busid:"b_wxg_wxplat_wxapp_realtime_log",data:JSON.stringify(i.data)})}var n,o=(n=s,function(){d.post({url:"/advanced/mplog?action=up",data:{need_verify:S,log:JSON.stringify({data:t}),logid:e}},function(e){return a=n,void((t=e)&&t.base_resp&&0===t.base_resp.ret?(I(a,w.loaded),++l===r&&(S&&d.post({url:"/advanced/mplog?action=up",data:{end:1,need_verify:S}}),m.notify("uploadSuccess"),console.log("上传成功"),(new Image).src="/mp/jsmonitor?idkey=69271_86_1")):((new Image).src="/mp/jsmonitor?idkey=69271_87_1",t&&t.base_resp&&200007===t.base_resp.ret?m.notify("noPermit"):m.notify("uploadFail"),I(a,w.failed)))
var t,a},function(){return I(n,w.failed),void m.notify("uploadFail")},null)})
m.notify("begin upload"),o()},t=0;t<x.length;t++)e(t)
else m.notify("emptyLog")}function L(){return new Promise(function(d){var u=0
O.get(p,f,null,function(e){var t,a,i,n=e.target.result
if(n){if(m.notify("success get"),j.push({time:n.value.time,level:n.value.level,location:n.value.location,description:n.value.description,data:n.value.data,timestamp:n.value.timestamp}),D(n)){var o=n.value
if(o.status){if(o.status===w.loading){var l=o.statusChangeTime
a=l,i=(new Date).getTime(),b<i-a&&(o.status=w.unload,o.beginLoadTime=null)}else if(o.status===w.failed){o.failTimes<_&&(o.status=w.unload,0)}}else o.status=w.unload,0
if(!0){n.update(o),"[object Object]"===Object.prototype.toString.call(o.data)?o.data=JSON.stringify(o.data):"[object String]"!==Object.prototype.toString.call(o.data)&&(o.data+=""),o.timestamp=parseInt(o.timestamp/1e3,10)
var r=(t=o,{id:n.primaryKey,data:{time:Math.ceil(new Date/1e3),dataTime:t.timestamp,level:h.indexOf(t.level),location:t.location,description:t.description+" autoupload",msg:JSON.stringify([{time:Math.ceil(t.timestamp/1e3),msg:t.data||""}]),uin:""+wx.uin}}),s=JSON.stringify(r).length
T<=s+u?(x.push([r]),u=s):(x[x.length-1].push(r),u+=s)}}n.continue()}else M(),d(j)})})}return{uploadLogs:function(){N()&&"mplog"!==J(window.location.href)&&(x=[[]],O=O||new n({dbName:o,dbStoreName:l}),L())},initiativeUploadLog:function(e){return S=0,a=(t=e).setBeginTime,i=t.setEndTime,s=!0,f=a&&i?(p=a,i):(p=parseInt(new Date/1e3,10)-86400,parseInt(new Date/1e3,10)),v="",N()?(x=[[]],j=[],O=O||new n({dbName:o,dbStoreName:l}),L()):null
var t,a,i},realTimeUpload:function(e){var t=[]
if(e&&e.length){for(var a=0;a<e.length;a++){var i=e[a];-1<i.location.indexOf("appmsg")&&t.push({interface:"mp_log",busid:"b_wxg_wxplat_wxapp_realtime_log",data:JSON.stringify({time:Math.ceil(new Date/1e3),dataTime:Math.ceil(i.timestamp/1e3),level:h.indexOf(i.level),location:i.location,description:i.description,data:"",msg:JSON.stringify([{time:Math.ceil(i.timestamp/1e3),msg:i.data||""}]),uin:""+wx.uin})})}0<t.length&&d.post({url:"/advanced/mplog?action=up",data:{need_verify:0,log:JSON.stringify({data:t})}})}}}})
"use strict"
define("pages/modules/mplog/notify.js",[],function(t,e,n){var i={listenData:[],listen:function(t,e){"string"==typeof t&&(t=[t])
for(var n=0;n<t.length;n++)Object.prototype.hasOwnProperty.call(i.listenData,t[n])||(i.listenData[t[n]]=[]),i.listenData[t[n]].push(e)},notify:function(t,e){if(Object.prototype.hasOwnProperty.call(i.listenData,t))for(var n=i.listenData[t],a=0;a<n.length;a++)n[a](t,e)}}
return i})
define("pages/editor/editor_store.js",["vat/vat.js","pages/modules/media_dialog/image_dialog/image_dialog_store.js"],function(e,a,i){"use strict"
var o
function s(e,a,i){return a in e?Object.defineProperty(e,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[a]=i,e}var d=e("vat/vat.js"),t=e("pages/modules/media_dialog/image_dialog/image_dialog_store.js"),r=new d.VatStore({modules:(s(o={},t.moduleName,t),s(o,"editor",{namespaced:!0,modules:{plugins:{namespaced:!0,modules:{}}}}),o)})
i.exports=r})
define("pages/modules/media_dialog/image_dialog/image_dialog_store.js",["pages/modules/media_dialog/image_dialog/mutations.js","pages/modules/utils/cgi.js","pages/modules/utils/url.js","pages/modules/media_dialog/image_dialog/report/report.js"],function(e,t,i){"use strict"
var o,p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]
for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},T=e("pages/modules/media_dialog/image_dialog/mutations.js")
function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t]
return i}return Array.from(e)}var I=e("pages/modules/utils/cgi.js"),f=e("pages/modules/utils/url.js").fullUrl,m=e("pages/modules/media_dialog/image_dialog/report/report.js"),S={1:"Pexels",3:"APE图库",4:"Pixabay"},U=0
function A(e,t){for(var i=0,o=e.length;i<o;++i)if(String(e[i].fileId)===String(t))return i
return-1}function c(e,t){var i=-1
return 0<=e.length&&(i=A(e,t.fileId)),-1!==i}var n={moduleName:"imageDialog",namespaced:!0,state:{scene:"cdn",innerStep:1,totalnum:0,maxSelect:1,perpage:12,currentPage:1,waterStatus:0,imgs:[],groups:[],selectedGroup:0,selectedImgs:[],cropImg:{url:""},cropImgInfo:[],cropperInfo:[],showLoading:!1,covertingCount:0,fromUpload:[],addGroupForm:{groupName:""},btnLoading:!1,addGroupLoading:!1,groupIdOfUploading:0,addGroupPopoverShow:!1,showSelectImg:!1,showPublicPicRules:!0,hasAgreePicRules:!1,showAgreeBtn:!0,agreeBtnLoading:!1,showSearchResult:!1,showSearchLoading:!1,needContinue:!1,imgsWrapperHeight:0,isScrollLoading:!1,lastSeq:0,lastLimit:0,actionScene:0,canUsePublicPic:!0},mutations:(r(o={},T.INNER_STEP_MUTATION,function(e,t){e.innerStep=+t}),r(o,T.WATER_STATUS_MUTATION,function(e,t){e.waterStatus=+t}),r(o,T.INIT_IMGS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.imgs=t)}),r(o,T.UPDATE_IMGS_MUTATION,function(e,t){var i=t.idx,o=t.item
if(o){var r=[].concat(s(e.imgs))
r[i]=o,e.imgs=r}}),r(o,T.ADD_IMGS_MUTATION,function(e,t){if(t){var i=[].concat(s(e.imgs))
i.unshift(t),e.imgs=i}}),r(o,T.REMOVE_IMGS_MUTATION,function(e,t){var i=[].concat(s(e.imgs))
i.splice(t,1),e.imgs=i}),r(o,T.UPDATE_IMG_URL_MUTATION,function(e,t){var i=t.idx,o=t.url
o&&(e.imgs[i].url=o)}),r(o,T.INIT_GROUPS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.groups=t)}),r(o,T.UPDATE_GROUPS_MUTATION,function(e,t){var i=t.idx,o=t.item
e.groups.splice(i,1,o)}),r(o,T.SELECTED_GROUP_MUTATION,function(e,t){e.selectedGroup=t}),r(o,T.SELECTED_IMGS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.selectedImgs=t)}),r(o,T.UPDATE_SELECTED_IMGS_MUTATION,function(e,t){var i=t.img,o=t.idx
if(i){var r=[].concat(s(e.selectedImgs))
r[o]=i,e.selectedImgs=r}}),r(o,T.ADD_SELECTED_IMGS_MUTATION,function(e,t){t&&e.selectedImgs.push(t)}),r(o,T.REMOVE_SELECTED_IMGS_MUTATION,function(e,t){e.selectedImgs.splice(t,1)}),r(o,T.UPDATE_SELECTED_IMGS_URL_MUTATION,function(e,t){var i=t.idx,o=t.url
o&&(e.selectedImgs[i].url=o)}),r(o,T.TOTAL_NUM_MUTATION,function(e,t){e.totalnum=+t}),r(o,T.CROP_IMG_MUTATION,function(e,t){e.cropImg=t}),r(o,T.CROP_IMG_INFO_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.cropImgInfo=t)}),r(o,T.CROPPER_INFO_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.cropperInfo=t)}),r(o,T.UPDATE_COVERTING_COUNT_MUTATION,function(e,t){e.covertingCount+=+t}),r(o,T.FROM_UPLOAD_MUTATION,function(e,t){t?e.fromUpload.push(t):e.fromUpload=[]}),r(o,T.CURRENT_PAGE_MUTATION,function(e,t){e.currentPage=+t}),r(o,T.STAR_UNSTAR_PICS_MUTATION,function(e,t){var i=t.isFavor,o=t.imgList,r=t.idx,s=e.selectedImgs.filter(function(e){return e.fileId===o[r].fileId})[0],n=e.imgs.filter(function(e){return e.fileId===o[r].fileId})[0]
s&&(s.isFavor=i),n&&(n.isFavor=i),-1!==e.selectedGroup||e.showSearchResult||e.showSelectImg||i||e.imgs.splice(r,1)}),r(o,T.UPDATE_PUBLIC_PICS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.imgs=[].concat(s(e.imgs),s(t)))}),r(o,T.CHANGE_PUBLIC_PICS_USE_STATUS_MUTATION,function(e,t){e.canUsePublicPic=t}),o),actions:{resetStateAction:function(e){var t=e.dispatch,i=e.commit
i(T.INNER_STEP_MUTATION,1),i(T.DEFAULT_GROUP_MUTATION,0),i(T.WATER_STATUS_MUTATION,0),i(T.INIT_IMGS_MUTATION,[]),i(T.SELECTED_GROUP_MUTATION,4),i(T.SELECTED_IMGS_MUTATION,[]),i(T.CURRENT_PAGE_MUTATION,1),i(T.TOTAL_NUM_MUTATION,0),i(T.FROM_UPLOAD_MUTATION,null),t("__set_state",{showLoading:!1,btnLoading:!1,addGroupLoading:!1,showSelectImg:!1,lastSeq:0,lastLimit:0})},setInnerStepAction:function(e,t){(0,e.commit)(T.INNER_STEP_MUTATION,t)},setSelectedGroupAction:function(e,t){(0,e.commit)(T.SELECTED_GROUP_MUTATION,t)},setSelectedImgsAction:function(e,t){(0,e.commit)(T.SELECTED_IMGS_MUTATION,t)},setTotalNumAction:function(e,t){(0,e.commit)(T.TOTAL_NUM_MUTATION,+t)},setCurrentPageAction:function(e,t){(0,e.commit)(T.CURRENT_PAGE_MUTATION,t)},setCropperInfoAction:function(e,t){(0,e.commit)(T.CROPPER_INFO_MUTATION,t)},setCropImgInfoAction:function(e,t){(0,e.commit)(T.CROP_IMG_INFO_MUTATION,t)},setCropImgAction:function(e,t){(0,e.commit)(T.CROP_IMG_MUTATION,t)},setFromUploadAction:function(e,t){(0,e.commit)(T.FROM_UPLOAD_MUTATION,t)},updateGroups:function(e,t){(0,e.commit)(T.UPDATE_GROUPS_MUTATION,t)},changeCovertingCount:function(e,t){(0,e.commit)(T.UPDATE_COVERTING_COUNT_MUTATION,+t)},replaceImgs:function(e,t){var i=e.commit,o=t.idx,r=t.item,s=t.selected
r.selected=!!s,i(T.UPDATE_IMGS_MUTATION,{idx:o,item:r})},addImgs:function(e,t){var i=e.commit,o=t.item,r=t.selected
o.selected=!!r,i(T.ADD_IMGS_MUTATION,o)},removeImgs:function(e,t){(0,e.commit)(T.REMOVE_IMGS_MUTATION,t)},updateSelectedImg:function(e,t){var i=e.commit,o=t.img,r=t.idx,s=t.selected
o.selected=!!s,i(T.UPDATE_SELECTED_IMGS_MUTATION,{img:o,idx:r})},selectImg:function(e,t){var i=e.state,o=e.dispatch,r=e.commit,s=t.i,n=t.currentImg,a=t.forceSelect
if(!n.error){var c=n.fileId,_=n.url
if(p(n,{copyrightStatus:n.status}),i.showSelectImg){var l=p({},i.selectedImgs[s]),u=A(i.imgs,c)
o("updateSelectedImg",{img:n,idx:s,selected:!l.selected}),0<=u&&o("replaceImgs",{idx:u,item:l,selected:!l.selected})}else{var g=p({},i.imgs[s])
if(a)-1===A(i.selectedImgs,c)&&r(T.ADD_SELECTED_IMGS_MUTATION,p({},n,{selected:!0})),o("replaceImgs",{idx:s,item:g,selected:!0})
else if(g.selected){var m=A(i.selectedImgs,c)
0<=m&&r(T.REMOVE_SELECTED_IMGS_MUTATION,m),o("replaceImgs",{idx:s,item:g,selected:!1})}else if(1===i.maxSelect){if(i.selectedImgs[0]){var d=A(i.imgs,i.selectedImgs[0].fileId)
if(0<=d)o("replaceImgs",{idx:d,item:p({},i.imgs[d]),selected:!1})
r(T.REMOVE_SELECTED_IMGS_MUTATION,0)}o("replaceImgs",{idx:s,item:g,selected:!0}),r(T.ADD_SELECTED_IMGS_MUTATION,p({},n,{selected:!0}))}else if(i.selectedImgs.length<i.maxSelect){-1===A(i.selectedImgs,c)&&r(T.ADD_SELECTED_IMGS_MUTATION,p({},n,{selected:!0})),o("replaceImgs",{idx:s,item:g,selected:!0})}}"cdn"===i.scene&&!_&&c&&o("getCdnUrlByFileId",c)}},selectGroup:function(e,t){var i=e.state,o=e.dispatch,r=e.commit,s=t.groupId,n=t.actionScene
i.selectedGroup!==s&&(r(T.SELECTED_GROUP_MUTATION,s),r(T.INIT_IMGS_MUTATION,[]),r(T.CURRENT_PAGE_MUTATION,1),o("__set_state",{showLoading:!0,showSelectImg:!1,showSearchResult:!1,lastSeq:0,lastLimit:0}),o("resetSelectedImgs"),-1===s?(o("__set_state",{showSearchLoading:!1}),i.showPublicPicRules||o("loadPublicPics",{})):o("getImagesByBegin",0).then(function(e){o("setTotalNumById",e.page_info.file_group_list.file_group),o("formatData",p({},e,{actionScene:n})).then(function(){o("__set_state",{showLoading:!1}),i.imgs.forEach(function(e,t){c(i.selectedImgs,e)&&o("selectImg",{i:t,currentImg:e,forceSelect:!0})})}).catch(function(){o("__set_state",{showLoading:!1})})}).catch(function(){console.log("get images error"),o("__set_state",{showLoading:!1})}))},setTotalNumById:function(e,t){for(var i=e.state,o=e.commit,r=1<arguments.length&&void 0!==t?t:[],s=0,n=r.length;s<n;s++)if(r[s].id===i.selectedGroup){o(T.TOTAL_NUM_MUTATION,r[s].count)
break}},formatData:function(e,i){var g=e.state,m=e.dispatch,d=e.commit,p=[]
return new Promise(function(r,e){i.page_info||e()
var s=0,n=0,a=0,c=i.page_info.file_item.length,_=g.selectedGroup,l=g.currentPage,u="",t=i.page_info.file_group_list.file_group
!g.canUsePublicPic||1!==i.actionScene&&2!==i.actionScene&&3!==i.actionScene||t.splice(1,0,{id:-1,name:"公共图片库"}),d(T.INIT_GROUPS_MUTATION,t),d(T.WATER_STATUS_MUTATION,i.page_info.watermark_status),(!i.page_info.file_item||i.page_info.file_item.length<=0)&&e(),i.page_info.file_item.forEach(function(t,i){var o=t.cdn_url||f("/cgi-bin/getimgdata?mode=small&source=file&fileId="+t.file_id),e=new Image
e.onerror=function(){++s,u=u+o+" ",++a===c&&((new Image).src="/mp/jsmonitor?idkey=28308_9_"+s+";28308_10_"+n+"&lc=1&log0=[errorurl]["+encodeURIComponent(u)+"]"),g.selectedGroup===_&&g.currentPage===l&&(p[i]={seq:t.seq,url:o,name:t.name,fileId:t.file_id,status:t.copyright_status||0,format:t.img_format,selected:!1},a===c&&(m("__set_state",{showLoading:!1}),d(T.INIT_IMGS_MUTATION,p),r()))},e.onload=function(){if(++n,++a===c){var e="/mp/jsmonitor?idkey=28308_9_"+s+";28308_10_"+n
0<s&&(e=e+"&lc=1&log0=[errorurl]["+encodeURIComponent(u)+"]"),(new Image).src=e}g.selectedGroup===_&&g.currentPage===l&&(p[i]={seq:t.seq,url:o,name:t.name,fileId:t.file_id,status:t.copyright_status||0,format:t.img_format,selected:!1},a===c&&(d(T.INIT_IMGS_MUTATION,p),r()))},e.src=o})})},getImagesByBegin:function(e,t){var o=e.state,i=e.commit,r=1<arguments.length&&void 0!==t?t:0,s=o.selectedGroup
i(T.INIT_IMGS_MUTATION,[])
var n=f("/cgi-bin/filepage?action=select")
return new Promise(function(t,i){I.get({url:n,data:{group_id:-1===s?0:s,begin:r,count:o.perpage,type:2},mask:!1},function(e){e.base_resp&&0===e.base_resp.ret?(o.selectedGroup!==s&&i(),t(e)):(I.handleRet(e,{url:n}),Vue.prototype.$tipsErr("系统繁忙，请稍后尝试"),i())},function(){Vue.prototype.$tipsErr("系统繁忙，请稍后尝试"),i()})})},getCdnUrlByFileId:function(e,o){var r=e.state,s=e.commit
s(T.UPDATE_COVERTING_COUNT_MUTATION,1),I.post({url:f("/cgi-bin/uploadimg2cdn?action=duplicate"),data:{file_id:o,group_id:r.selectedGroup||1},mask:!1},function(e){var t=A(r.selectedImgs,o),i=A(r.imgs,o)
0===Number(e.errcode)?(0<=t&&s(T.UPDATE_SELECTED_IMGS_URL_MUTATION,{idx:t,url:e.url}),0<=i&&s(T.UPDATE_IMG_URL_MUTATION,{idx:t,url:e.url})):(Vue.prototype.$tipsErr("转存失败"),0<=t&&s(T.REMOVE_SELECTED_IMGS_MUTATION,t),0<=i&&s(T.REMOVE_IMGS_MUTATION,t)),s(T.UPDATE_COVERTING_COUNT_MUTATION,-1)},function(){Vue.prototype.$tipsErr("系统繁忙，请稍后尝试")})},createGroup:function(e,t){var n=e.state,a=e.dispatch,c=e.commit,_=t.actionScene
a("__set_state",{addGroupLoading:!0}),I.post({url:f("/cgi-bin/filepage?action=create_group"),data:{name:n.addGroupForm.groupName},mask:!1},function(e){a("__set_state",{addGroupLoading:!1})
var t=Number(e.base_resp.ret)
if(0===t){var s=n.addGroupForm.groupName
a("__set_state",{addGroupForm:{groupName:""},addGroupPopoverShow:!1,showLoading:!0,showSelectImg:!1}),a("resetSelectedImgs"),a("getImagesByBegin",0).then(function(e){a("__set_state",{showLoading:!1})
var t=e.page_info
!n.canUsePublicPic||1!==_&&2!==_&&3!==_||t.file_group_list.file_group.splice(1,0,{id:-1,name:"公共图片库"})
for(var i=!1,o=0;o<t.file_group_list.file_group.length;o++){var r=t.file_group_list.file_group[o]
if(r.name===s){c(T.SELECTED_GROUP_MUTATION,r.id),i=!0
break}}i&&(c(T.INIT_GROUPS_MUTATION,t.file_group_list.file_group),c(T.INIT_IMGS_MUTATION,[]),c(T.TOTAL_NUM_MUTATION,0),c(T.CURRENT_PAGE_MUTATION,1))}).catch(function(){a("__set_state",{showLoading:!1})})}else 15006===t?Vue.prototype.$tipsErr("已经超过100个分组，不能再创建新的分组。"):Vue.prototype.$tipsErr("创建失败，请重试")})},pageChange:function(e,t){var i=e.state,o=e.dispatch,r=e.commit,s=t.pages,n=t.actionScene,a=(s.currentPage-1)*i.perpage
r(T.CURRENT_PAGE_MUTATION,s.currentPage),o("__set_state",{showLoading:!0}),o("getImagesByBegin",a).then(function(e){o("formatData",p({},e,{actionScene:n})).then(function(){o("__set_state",{showLoading:!1}),i.imgs.forEach(function(e,t){c(i.selectedImgs,e)&&o("selectImg",{i:t,currentImg:e,forceSelect:!0})})}).catch(function(){o("__set_state",{showLoading:!1})})}).catch(function(){o("__set_state",{showLoading:!1})})},changeViewToSelectedImg:function(e){(0,e.dispatch)("__set_state",{showSelectImg:!0})},changeViewToAllImg:function(e){var t=e.state,i=e.dispatch
i("__set_state",{showSelectImg:!1}),t.showPublicPicRules||-1!==t.selectedGroup||t.showSearchResult||(i("__set_state",{lastSeq:0,lastLimit:0}),i("loadPublicPics",{})),i("resetSelectedImgs")},resetSelectedImgs:function(e){var t=e.state;(0,e.commit)("SELECTED_IMGS_MUTATION",t.selectedImgs.filter(function(e){return e.selected}))},agreeStatement:function(e){var o=e.dispatch
o("__set_state",{agreeBtnLoading:!0}),I.post({url:"/cgi-bin/photogallery?action=agree_license",data:{},success:function(e){var t=0<arguments.length&&void 0!==e?e:{}
o("__set_state",{agreeBtnLoading:!1})
var i=t.base_resp&&+t.base_resp.ret
switch(i){case 0:o("__set_state",{showAgreeBtn:!1,showPublicPicRules:!1})
break
default:console.error(i),Vue.prototype.$tipsErr("系统错误，请稍后重试")}},error:function(){o("__set_state",{agreeBtnLoading:!1}),Vue.prototype.$tipsErr("系统错误，请稍后重试")}})},loadPublicPics:function(e,t){var i,u=e.state,o=e.commit,r=e.dispatch,s=t.query,n=void 0===s?"":s,a=t.type,c=void 0===a?0:a,_=t.onlyCheck,l=void 0!==_&&_,g=t.isScroll,m=void 0!==g&&g,d=t.checkExposed,p=void 0===d?function(){}:d
if(!l){if(m&&u.isScrollLoading)return
r("__set_state",{isScrollLoading:m}),m||o(T.INIT_IMGS_MUTATION,[]),n.length&&r("__set_state",{showSearchResult:!0,showSearchLoading:!0})}I.get({url:"/cgi-bin/photogallery?action=search",data:(i=12,0!==u.imgsWrapperHeight&&(i=u.showSearchResult?4*(Math.ceil((u.imgsWrapperHeight-62)/191)+1):4*(Math.ceil((u.imgsWrapperHeight-314)/191)+1)),l||r("__set_state",{lastSeq:u.lastSeq+u.lastLimit,lastLimit:i}),{query:n,type:c,limit:i,last_seq:u.lastSeq}),success:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.base_resp&&+t.base_resp.ret
switch(i){case 0:if(l&&!m)return void r("__set_state",{showPublicPicRules:!1,hasAgreePicRules:!0,showAgreeBtn:!1})
r("__set_state",{needContinue:!!t.need_continue,showSearchLoading:!!t.need_continue}),m&&r("__set_state",{isScrollLoading:!1}),o(T.UPDATE_PUBLIC_PICS_MUTATION,t.result.map(function(e){var t=e.seq,i=e.is_favorite,o=e.photo,r=o.unique_id,s=o.supplier,n=o.type,a=u.selectedImgs.some(function(e){return r&&e.fileId===r}),c=e.photo,_=c.url,l=c.medium_url
return{seq:t,name:S[s]?S[s]+"提供":"未知提供方",fileId:r,status:0,format:"",isFromPublic:!0,mediumUrl:l,externalUrl:_,url:"https://mp.weixin.qq.com/cgi-bin/photogalleryproxy?action=proxy&url="+encodeURIComponent(_)+"&supplier="+s+"&from_public_pic=1",supplier:s,photoShapeType:n,selected:a,isFavor:!!i,error:!1}})),u.imgs.forEach(function(e,t){var i=new Image
i.onerror=function(){u.imgs[t]&&(u.imgs[t].error=!0)},i.src=e.mediumUrl}),n.length&&(m||(U=0),0===t.result.length?++U:U=0,3===U&&r("__set_state",{needContinue:!1,showSearchLoading:!1}),p())
break
case 730001:l||Vue.prototype.$tipsErr("请先同意并遵守《微信公众平台公共图片库使用条款》"),n.length&&r("resetLoadingStatus")
break
case 730004:o(T.CHANGE_PUBLIC_PICS_USE_STATUS_MUTATION,!1)
break
default:console.error(i),l||Vue.prototype.$tipsErr("系统错误，请稍后重试"),n.length&&r("resetLoadingStatus")}},error:function(){Vue.prototype.$tipsErr("系统错误，请稍后重试"),n.length&&r("resetLoadingStatus")}})},resetLoadingStatus:function(e){(0,e.dispatch)("__set_state",{showSearchLoading:!1,isScrollLoading:!1})},star:function(e,t){var o=e.state,r=e.commit,s=t.imgList,n=t.idx,i=s[n],a=i.isFavor,c=i.externalUrl,_=i.mediumUrl,l=i.photoShapeType,u=i.supplier,g=i.fileId
I.post({url:"/cgi-bin/photogallery?action=favor",data:{is_remove:+a,photo:JSON.stringify({url:c,medium_url:_,type:l,supplier:u,unique_id:g})},success:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.base_resp&&+t.base_resp.ret
switch(i){case 0:r(T.STAR_UNSTAR_PICS_MUTATION,{isFavor:!a,imgList:s,idx:n}),a||m.r21606({bizUin:window.wx.commonData.uin,fileId:g,supplier:u,actionScene:o.actionScene,actionType:1})
break
case 730002:Vue.prototype.$tipsErr("操作过于频繁，请稍后再试")
break
case 730003:Vue.prototype.$tipsErr("收藏失败，最多收藏1000张图片")
break
default:console.error(i),Vue.prototype.$tipsErr("系统错误，请稍后重试")}},error:function(){Vue.prototype.$tipsErr("系统错误，请稍后重试")}})}}}
i.exports=n})
define("pages/modules/media_dialog/image_dialog/mutations.js",[],function(T,_,I){"use strict"
Object.defineProperty(_,"__esModule",{value:!0})
_.INNER_STEP_MUTATION="INNER_STEP_MUTATION",_.DEFAULT_GROUP_MUTATION="DEFAULT_GROUP_MUTATION",_.WATER_STATUS_MUTATION="WATER_STATUS_MUTATION",_.INIT_IMGS_MUTATION="INIT_IMGS_MUTATION",_.UPDATE_IMGS_MUTATION="UPDATE_IMGS_MUTATION",_.ADD_IMGS_MUTATION="ADD_IMGS_MUTATION",_.REMOVE_IMGS_MUTATION="REMOVE_IMGS_MUTATION",_.UPDATE_IMG_URL_MUTATION="UPDATE_IMG_URL_MUTATION",_.INIT_GROUPS_MUTATION="INIT_GROUPS_MUTATION",_.UPDATE_GROUPS_MUTATION="UPDATE_GROUPS_MUTATION",_.SELECTED_GROUP_MUTATION="SELECTED_GROUP_MUTATION",_.SELECTED_IMGS_MUTATION="SELECTED_IMGS_MUTATION",_.UPDATE_SELECTED_IMGS_MUTATION="UPDATE_SELECTED_IMGS_MUTATION",_.ADD_SELECTED_IMGS_MUTATION="ADD_SELECTED_IMGS_MUTATION",_.REMOVE_SELECTED_IMGS_MUTATION="REMOVE_SELECTED_IMGS_MUTATION",_.UPDATE_SELECTED_IMGS_URL_MUTATION="UPDATE_SELECTED_IMGS_URL_MUTATION",_.TOTAL_NUM_MUTATION="TOTAL_NUM_MUTATION",_.CROP_IMG_MUTATION="CROP_IMG_MUTATION",_.CROP_IMG_INFO_MUTATION="CROP_IMG_INFO_MUTATION",_.CROPPER_INFO_MUTATION="CROPPER_INFO_MUTATION",_.UPDATE_COVERTING_COUNT_MUTATION="UPDATE_COVERTING_COUNT_MUTATION",_.FROM_UPLOAD_MUTATION="FROM_UPLOAD_MUTATION",_.CURRENT_PAGE_MUTATION="CURRENT_PAGE_MUTATION",_.STAR_UNSTAR_PICS_MUTATION="STAR_UNSTAR_PICS_MUTATION",_.UPDATE_PUBLIC_PICS_MUTATION="UPDATE_PUBLIC_PICS_MUTATION",_.CHANGE_PUBLIC_PICS_USE_STATUS_MUTATION="CHANGE_PUBLIC_PICS_USE_STATUS_MUTATION"})
define("pages/modules/media_dialog/image_dialog/report/report.js",["3rd/utils/comm_report.js"],function(i,e,o){"use strict"
var r=i("3rd/utils/comm_report.js")
o.exports={r21606:function(i){r.report(21606,{bizuin:+i.bizUin,pic_id:""+i.fileId,pic_source:+i.supplier,action_scene:+i.actionScene,action_type:+i.actionType})}}})
define("3rd/utils/comm_report.js",["pages/modules/utils/cgi.js","3rd/utils/mmbizcommon_js/utils/comm_report.js"],function(e,s,o){"use strict"
var t=e("pages/modules/utils/cgi.js"),r=e("3rd/utils/mmbizcommon_js/utils/comm_report.js")
o.exports={report:function(e,s,o){r.report("web",t,e,s,o)},leaveReport:function(e,s){r.leaveReport("web",t,e,s)}}})
"use strict"
define("3rd/utils/mmbizcommon_js/utils/comm_report.js",[],function(r,e,o){function n(r,e){return(e=JSON.parse(JSON.stringify(e))).log_id=r,console.log("[comm_report] reportjson: ",e),JSON.stringify(e)}var s={web:{report:"/cgi-bin/webreport"},wap:{report:"/mp/wapcommreport"}},c=!1,p=[],a={web:{report:function(r,e,o,t){t=t||{},r.post({url:s.web.report,data:{reportjson:n(e,o)},async:t.async,success:t.success,error:t.error})},leaveReport:function(r,e,o){if(p.push([r,e,o]),!c){var t=!(c=!0),n=function(){t||(t=!0,p.forEach(function(r){a.web.report(r[0],r[1],r[2])}))}
window.addEventListener("beforeunload",n,!1),window.addEventListener("unload",n,!1)}}},wap:{report:function(r,e,o,t){t=t||{},r({type:"POST",dataType:"json",url:s.wap.report,data:{reportjson:n(e,o)},async:t.async,success:t.success,error:t.error})}}}
return{report:function(r,e,o,t,n){a[r].report(e,o,t,n)},leaveReport:function(r,e,o,t){a[r].leaveReport(e,o,t)},getUrl:function(r,e){return s[r][e]},getData:function(r,e,o){var t=n(r,e)
return o&&(t=encodeURIComponent(t)),"reportjson="+t}}})
define("pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.js",["pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.css.js","pages/modules/verify_code/verify_code.js","vue-weui/src/form/form.js","vue-weui/src/input/input.js","vue-weui/src/form/form_item.js","vue-weui/src/dropdown/dropdown.js","vue-weui/src/switch/switch.js","vue-weui/src/time_picker/time_picker.js","vue-weui/src/cascader/cascader.js","pages/modules/region/region.js","vue-weui/src/dropdown_cascade/dropdown_cascade.js","pages/modules/masssend/originalDialog/originalDialog.js","pages/modules/utils/str_util.js","3rd/moment/moment.js","pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.tpl.js","pages/modules/utils/cgi.js","js/message/message_cgi.js","pages/modules/utils/url.js","js/common/wx/media/factory.js","js/common/wx/mpEditor/common/eventbus.js","pages/editor/eventBus4Web1.js","3rd/editor/common/monitor.js","js/safe/safe_check.js","js/tpl/mass/sendqueue_popup.html.js"],function(u,i,t){"use strict"
var e,a=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]
for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=e[a])}return i}
function o(i){return function(){var n=i.apply(this,arguments)
return new Promise(function(r,o){return function t(i,e){try{var a=n[i](e),s=a.value}catch(i){return void o(i)}if(!a.done)return Promise.resolve(s).then(function(i){t("next",i)},function(i){t("throw",i)})
r(s)}("next")})}}function s(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}u("pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.css.js"),u("pages/modules/verify_code/verify_code.js"),u("vue-weui/src/form/form.js"),u("vue-weui/src/input/input.js"),u("vue-weui/src/form/form_item.js"),u("vue-weui/src/dropdown/dropdown.js"),u("vue-weui/src/switch/switch.js"),u("vue-weui/src/time_picker/time_picker.js"),u("vue-weui/src/cascader/cascader.js"),u("pages/modules/region/region.js"),u("vue-weui/src/dropdown_cascade/dropdown_cascade.js"),u("pages/modules/masssend/originalDialog/originalDialog.js")
var S=u("pages/modules/utils/str_util.js"),m=u("3rd/moment/moment.js"),r=u("pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.tpl.js"),n=u("pages/modules/utils/cgi.js"),d=u("js/message/message_cgi.js"),c=u("pages/modules/utils/url.js"),h=u("js/common/wx/media/factory.js"),p=u("js/common/wx/mpEditor/common/eventbus.js"),g=u("pages/editor/eventBus4Web1.js"),l=u("3rd/editor/common/monitor.js"),_=u("js/safe/safe_check.js")
var f=function(i){var t="",e="",a=""
if(void 0===i)return""
for(var s=0,r=i.length;s<r;s++){var o=i[s].func_id,n=i[s].unlock_time,d=i[s].ban_time
"2"==o?e=n?n==d?"永久屏蔽原创功能":"屏蔽原创功能至"+m.unix(n).format("YYYY年MM月DD日 HH:mm"):"":"3"==o&&(a=n?n==d?"永久屏蔽赞赏功能":"屏蔽赞赏功能至"+m.unix(n).format("YYYY年MM月DD日 HH:mm"):"")}return e&&a?t=S.sprintf("经用户举报，你的帐号已%s，已%s，屏蔽期间发出的文章将没有原创及赞赏标识。<br>",e,a):e?t=S.sprintf("经用户举报，你的帐号已%s，因为赞赏仅向原创文章开放，因而屏蔽期间赞赏功能也不可使用。本文发出后将没有原创及赞赏标识。<br>",e):a&&(t=S.sprintf("经用户举报，你的帐号已%s，屏蔽期间发出的文章将没有赞赏标识。<br>",a)),t}(wx.cgiData.forbit)
function b(i,t,e){e.mid="mmbizweb:editor/masssend","warn"===i&&(e.msg&&(t+="["+e.msg+"]"),WX_BJ_REPORT.BadJs.report(i,t,e)),"error"===i&&(e.msg&&(t+="["+e.msg+"]"),WX_BJ_REPORT.BadJs.report(i,t,e))}function w(i,t,e,a){0===t?"[object Function]"===Object.prototype.toString.call(a)&&a(i):("[object Function]"===Object.prototype.toString.call(e)&&e(i,t),v=setTimeout(function(){return w(i,--t,e,a)},1e3))}var v=null,y={delay:0,time:0,data:{},timeout:6e4,dialogAppearTime:3,oriCheckDialogLive:10,check:function(t,e,i,a){var s=this
i&&w(e,this.dialogAppearTime,function(i,t){console.log(t)},function(i){i.innerShow=!1,i.copyRightingShow=!0,w(i,s.oriCheckDialogLive,function(i,t){i.btTxt="原创校验中("+t+")",i.copyRightingContent="原创校验中，预计等待时间"+t+"秒",i.$refs.oriProgressBar.style.width=(s.oriCheckDialogLive-t)/s.oriCheckDialogLive*100+"%"},function(i){i.$refs.oriProgressBar.style.width="99%"})})
var r={first_check:i?1:0,type:t.type,appmsgid:t.appmsgid}
this.data=t,d.checkCopyright(r,function(i){switch(i&&i.base_resp&&void 0!==i.base_resp.ret||(ret=-1),+i.base_resp.ret){case 154008:case 154009:s.done(i,e,a)
break
case 154011:s.polling(t,e,a)
break
case 200013:e.$tipsErr("操作太频繁，请稍后再试"),s.reset(e),b("error","Copyright",{msg:i.base_resp.ret})
break
case 64715:e.innerShow=!1,clearTimeout(v),e.copyRightingShow=!1,e.submitDisabled=!1,p.fireEvent("showMassSendOriginalDialog",{list:i&&i.check_copyright_declare_resp_info&&i.check_copyright_declare_resp_info.check_copyright_declare_resp_list||[]})
break
default:e.$tipsErr("系统错误，请稍后重试。"),s.reset(e),b("error","Copyright",{msg:i.base_resp.ret})}},function(i){"mass_send_check_copyright_timeout"!=i&&s.polling(t,e)})},polling:function(i,t,e){var a=this
0===this.delay?this.delay=10:this.delay=500,this.time<this.timeout?(setTimeout(function(){a.check(i,t,!1,e)},this.delay),this.time+=this.delay):(this.reset(t),this.delay=0,this.time=0,this.data={})},done:function(i,t,e){154009===i.base_resp.ret?(this.data.direct_send=1,e(this.data)):154008===i.base_resp.ret?(t.postData.list=i.list||"",t.originalList=JSON.parse(i.list).list,t._orglist=i.list,t.originalAppmsgid=this.data.appmsgid+"",t.originalDialogShow=!0,t.innerShow=!1,b("warn","Copyright",{msg:i.base_resp.ret,_info:{list:i.list}})):(b("error","Copyright",{msg:i.base_resp.ret}),t.$tipsErr("系统错误，请稍后重试。")),this.reset(t),this.delay=0,this.time=0,this.data={}},reset:function(i){i.btTxt="群发",clearTimeout(v),i.copyRightingShow=!1,i.submitDisabled=!1}},D={withoutADWoring:"",check:function(w,v){var y=this
return b("info","Ad.check",{msg:JSON.stringify(w)}),new Promise(function(f){d.checkSponsorAd({appmsg_id:w.appmsgid},function(i){if(y.withoutADWoring="",0==i.base_resp.ret){for(var t=i.check_ad_resp.ad_info,e=i.check_ad_resp.ad_num,a=i.check_ad_resp.article_aid_num,s=i.check_ad_resp.article_aid_list,r=w.isMulti,o="",n=0;n<s.length;n++)for(var d=0;d<t.length;d++)t[d].idx==s[n].idx&&(t[d].save_aid=s[n].aid)
if(r||0!=e||1!=a)if(r&&0==e&&1==a)o=1==s[0].idx?"今日图文首篇文章暂无广告订单，但含有广告卡片，请删除该广告订单后再群发。":"今日图文第二篇文章暂无广告订单，但含有广告卡片，请删除该广告订单后再群发。",y.warn(o,v)
else if(1==e&&2==a)o=1==t[0].idx?"今日图文第二篇文章暂无广告订单，但含有广告卡片，请删除该广告订单后再群发。":"今日图文首篇文章暂无广告订单，但含有广告卡片，请删除该广告订单后再群发。",y.warn(o,v)
else if(0==e&&2==a)o="今日图文首篇文章暂无广告订单，但含有广告卡片，第二篇文章暂无广告订单，但含有广告卡片，请删除该广告订单后再群发。",y.warn(o,v)
else if(0==e&&0==a)f(w.appmsgid)
else if(1==e)2!=t[0].idx||r?(o="今日图文"+y._getAdWordingHead(r,t[0])+y._getAdWordingBody(t[0])+y._getAdWordingFoot(t[0]),"SponsorAdPreview"==y._getFuncName(t[0])?y.preview(o,t,v):"SponsorAdDefault"==y._getFuncName(t[0])?y.warn(o,v):"checkMusic"==y._getFuncName(t[0])?(y.withoutADWoring=o,f(w.appmsgid)):"SponsorAdOther"==y._getFuncName(t[0])&&y.warn(o,v)):(o=S.sprintf("今日图文第二篇广告主为%s，群发单图文将会导致广告违约，请继续编辑素材。",t[0].ad_buyer_name),y.warn(o,v))
else if(2==e){if(r){var c=y._getAdWordingHead(r,t[0]),u=y._getAdWordingHead(r,t[1]),m=y._getAdWordingBody(t[0]),h=y._getAdWordingBody(t[1]),p=y._getAdWordingFoot(t[0]),g=y._getAdWordingFoot(t[1]),l=y._getFuncName(t[0]),_=y._getFuncName(t[1])
o="今日图文"+c+m+u+h+(""==p||""==g?"":p),"SponsorAdDefault"==l||"SponsorAdDefault"==_||"SponsorAdOther"==l||"SponsorAdOther"==_?y.warn(o,v):"SponsorAdPreview"==l||"SponsorAdPreview"==_?y.preview(o,t,v):(y.withoutADWoring=o,f(w.appmsgid))}else o=S.sprintf("今日图文首篇广告主为%s，第二篇广告主为%s，群发单图文将会导致广告违约，请继续编辑素材。",t[0].ad_buyer_name,t[1].ad_buyer_name),y.warn(o,v)
b("warn","AD",{msg:i.base_resp.ret,_info:{ad_info:t,ad_num:e,article_aid_num:a,article_aid_list:s,isMulti:r,content:o}})}else f(w.appmsgid)
else o="今日图文暂无广告订单，但含有广告卡片，请删除该广告卡片后再群发。",y.warn(o,v)}else b("error","AD",{msg:i.base_resp.ret}),v.$tipsErr("系统错误")},function(i){})})},warn:function(i,t){t.adWarnShow=!0,t.innerShow=!1,t.adWarnContent=i},preview:function(i,t,e){for(var a=0;a<t.length;a++)t[a].video_info&&(t[a].ad_img=t[a].video_info.thumbUrl)
e.adViewShow=!0,e.adViewList=t,e.innerShow=!1,e.adViewContent=i},_getAdWordingHead:function(i,t){var e="广告主为%s，",a="首篇广告主为%s，",s="第二篇广告主为%s，"
return i||1!=t.idx?i&&1==t.idx?S.sprintf(a,t.ad_buyer_name):2==t.idx?S.sprintf(s,t.ad_buyer_name):void 0:S.sprintf(e,t.ad_buyer_name)},_getAdWordingBody:function(i){var t="图文内广告已准备完毕。",e="图文内插入对应广告后尚未发送给广告主预览，请确认后再群发。",a="该广告素材于%s更新，图文内广告已准备完毕。",s="%s提交更新的素材仍在审核中，若直接群发，图文不带广告素材且不会导致违约。",r="图文内尚未插入对应广告，群发图文会导致广告违约，请继续编辑素材。",o="图文内插入对应广告后，须广告主确认才可群发。"
return i.save_aid==i.ad_id&&1==i.status&&(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode)?t:i.save_aid!=i.ad_id||1!=i.status&&2!=i.status||3!=i.ad_status?i.save_aid==i.ad_id&&2==i.status&&(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode)?S.sprintf(a,m.unix(i.update_time).format("YYYY-MM-DD")):i.save_aid!=i.ad_id&&i.save_aid||3!=i.status?(i.save_aid||1!=i.status&&2!=i.status)&&i.save_aid==i.ad_id?i.save_aid!=i.ad_id||1!=i.status&&2!=i.status||6==i.ad_status||1!=i.trade_mode?void 0:o:r:S.sprintf(s,m.unix(i.update_time).format("YYYY-MM-DD")):e},_getAdWordingFoot:function(i){var t="消息开始群发后无法撤回，是否群发？"
return(i.save_aid!=i.ad_id||1!=i.status||!(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode))&&(i.save_aid!=i.ad_id||2!=i.status||!(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode))&&(i.save_aid!=i.ad_id&&i.save_aid||3!=i.status)?"":t},_getFuncName:function(i){return i.save_aid==i.ad_id&&1==i.status&&(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode)?"SponsorAdPreview":i.save_aid!=i.ad_id||1!=i.status&&2!=i.status||3!=i.ad_status?i.save_aid==i.ad_id&&2==i.status&&(4==i.ad_status&&0==i.trade_mode||6==i.ad_status&&1==i.trade_mode)?"SponsorAdPreview":i.save_aid!=i.ad_id&&i.save_aid||3!=i.status?(i.save_aid||1!=i.status&&2!=i.status)&&i.save_aid==i.ad_id?i.save_aid!=i.ad_id||1!=i.status&&2!=i.status||6==i.ad_status||1!=i.trade_mode?void 0:"SponsorAdOther":"SponsorAdDefault":"checkMusic":"SponsorAdDefault"}},k={param:{},scan:function(t){_.check(this.param,function(i){t.postData.code=i.code,t.post()},{onShow:function(){t.innerShow=!1},onClose:function(){t.innerShow=!0},checkdom:".js_wxcheck0"})}},j=function(a,s){return b("info","Music.check",{msg:a}),new Promise(function(e){n.post({url:"/cgi-bin/masssend?action=check_music",data:{appmsgid:a},error:function(){e()}},function(i){var t=i&&i.base_resp?i.base_resp.ret:-1
0!=t||i.list&&0!==i.list.length?0==t&&i.list&&0<i.list.length?(s.innerShow=!1,p.fireEvent("showMusicCheckDialog",{focustype:"callback",appmsgid:a,musicdata:i.list}),b("warn","Music",{msg:i.base_resp.ret,_info:{list:i.list}})):(b("error","Music",{msg:i.base_resp.ret}),e()):e()})})},x=(s(e={loading:!1,direct_send:0,isPreviewing:!1,timeConfirmShow:!1,copyRightingShow:!1,copyRightedShow:!1,copyRightingContent:"原创校验中，预计等待时间10秒",needVerifycode:!1,verifyCode:"",sameMaterialStatus:0,safeScan:!0,confirmStauts:0,adViewList:[],adViewContent:"",adViewShow:!1,adWarnContent:"",adWarnShow:!1,nick_name:wx.cgiData.nick_name,originalList:[],originalAppmsgid:"",postData:{},originalDialogShow:!1,_orglist:""},"originalList",[]),s(e,"originalAppmsgid",""),s(e,"btTxt","群发"),s(e,"submitDisabled",!1),s(e,"confirmShow",!1),s(e,"confirmMsg",""),s(e,"group",[-1]),s(e,"areas",{country:{label:"",value:-1}}),s(e,"innerShow",!1),s(e,"timer",!1),s(e,"curTime",""),s(e,"curTime2","00:00"),s(e,"minTime",""),s(e,"sex","0"),s(e,"day","1"),s(e,"sexData",[{label:"全部",value:"0"},{label:"男",value:"1"},{label:"女",value:"2"}]),s(e,"dayData",[{label:"今天",value:"1"},{label:"明天",value:"2"}]),e)
Vue.component("masssend-send-dialog",{template:r,mounted:function(){var c=this
$(document).on("click",".js_viewqueue",function(){var i,t={type:$(this).data("type"),wx_alias:JSON.parse(c.data.cgiData.strategy_info).wx_alias||"",list:[]}
if("polo"==t.type?(t.count=+c.data.cgiData.auditing_msg_num||0,c.data.cgiData.aduting_msg_json&&(t.list=JSON.parse(c.data.cgiData.aduting_msg_json).list),i="待发送群发消息详情"):"timer"==t.type&&(t.count=+c.data.cgiData.auditing_timer_msg_num||0,c.data.cgiData.auditing_timer_msg_json&&(t.list=JSON.parse(c.data.cgiData.auditing_timer_msg_json).list),i="待确认定时消息详情"),0!=t.count&&0!=t.list.length){for(var e=0,a=t.list.length;e<a;e++)t.list[e].apply_time_desc=m.unix(t.list[e].apply_time).format("YYYY.MM.DD HH:mm")||"",t.list[e].expired_time_desc=m.unix(t.list[e].expired_time).format("YYYY.MM.DD HH:mm")||"",t.list[e].applyer_headimg=t.list[e].applyer_headimg||"http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8p5jb6RZ8aYfjfS2AVle8URwBt8QIu6XbGewB9wiaWYWkPwq4R7pfdsFibuLkic16UcxDSNYtB8HnC1Q/0"
var s=u("js/tpl/mass/sendqueue_popup.html.js"),r=$(wx.T(s,t)).eq(0).popup({title:i,close:function(){this.remove()},className:"sendqueue_dialog",width:960,buttons:[{text:"知道了",click:function(){this.remove()},type:"primary"}]})
c.innerShow=!1
for(var o=r.find(".js_masscontent"),n=(e=0,t.list.length);e<n;e++)d(t.list[e],e)
r.popup("resetPosition"),r.find(".js_massitem").on("click",function(){var i=$(this),t="selected"
if(i.hasClass(t))return!1
i.siblings(".js_massitem").removeClass(t),i.addClass(t)
var e=$(this).data("index")
o.find(".js_mediaitem").hide(),o.find(".js_media"+e).show(),r.popup("resetPosition")})}function d(i,t){var e=function(i){var t,e=i.detail_info
if(!e)return null
switch(e.type={9:"10",11:"10",16:"15",17:"16",62:"4"}[e.type]||e.type,+e.type){case 10:t={data:e,type:e.type}
break
case 15:if((t=e).multi_item&&0<e.multi_item.length){var a=e.multi_item[0]
for(var s in a)a.hasOwnProperty(s)&&!t[s]&&(t[s]=a[s])}!t.time&&t.create_time&&(t.time=m.unix(t.create_time).format("YYYY年MM月DD日")||"")
break
case 16:(t=card_parser.parse_cardticket(e.card)).type=e.type
break
default:t=e}return t.acl=wx.acl.msg_acl,t}(i),a=h.itemRender[e.type]
if(e&&a){var s=o.find(".js_media"+t)
1!=+e.type&&2!=+e.type&&3!=+e.type||s.addClass("simple_media"),e.hasRecommend=!0,a(s,e)}}}),g.$on("previewClose",function(){c.isPreviewing=!1,c.originalDialogShow=!0})},methods:{cancelConfirm:function(){this.confirmShow=!1,this.innerShow=!0},onPreview:function(){this.isPreviewing=!0},timerSwitchChange:function(i){i?l.setSum(129180,42,1).send():this.hot_time_type=0},groupSwitchChange:function(i){i&&l.setSum(129180,43,1).send()},timerChange:function(i,t){var e=this
n.post({url:"/cgi-bin/masssend?action=check_hot_time",data:{timestamp:Math.floor(t/1e3)}},function(i){i&&i.base_resp&&0==i.base_resp.ret&&0<=i.hot_time_type&&(1==i.hot_time_type?(b("warn","hot_time_type",{msg:i.hot_time_type}),e.hot_time_word="该时刻定时消息过多，你的消息可能延后发送，你可以继续群发或选择其他时刻。",e.hot_time_type=1,e.submitDisabled=!1):2==i.hot_time_type?(b("warn","hot_time_type",{msg:i.hot_time_type}),e.hot_time_word="该时刻定时消息过多，请选择其他时刻。",e.hot_time_type=2,e.submitDisabled=!0):(e.hot_time_word="",e.hot_time_type=0,e.submitDisabled=!1))})},originalDialogShowChange:function(i){this.originalDialogShow=i},originalDialogCancel:function(){this.innerShow=!0},originalDialogSubmit:function(i){var t=this
this.postData.reprint_confirm=1,this.postData.list=this._orglist,this.originalList.each(function(i){t.data.appmsg.multi_item[i.idx-1].isCopyright=!1,t.data.appmsg.multi_item[i.idx-1].isReward=!1}),i&&(this.postData.reprint_info=JSON.stringify({item_list:i})),this.originalDialogShow=!1,b("info","originalDialogSubmit",{msg:JSON.stringify(this.postData)}),D.check(this.postData,this).then(function(i){return j(i,t)}).then(function(){t.checkSafe()})},submit:function(){var i={ack:"",code:"",reprint_info:"",reprint_confirm:0,list:"",groupid:"",sex:this.sex,country:"",province:"",city:"",send_time:0,type:10,share_page:1,synctxweibo:0,operation_seq:this.data.cgiData.operation_seq,req_id:function(i){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<i;a++)t+=e.charAt(Math.floor(Math.random()*e.length))
return t}(32),req_time:(new Date).getTime()+1e3*this.data.diff,sync_version:1}
if(this.data.appmsg&&(i=a(i,{appmsgid:this.data.appmsg.app_id,isMulti:this.data.appmsg.isMulti})),b("info","submitBegin",{msg:JSON.stringify(i)}),this.hasGroup&&(-1===this.group[0]?i.groupid=-1:"group"===this.group[0]?i.groupid=this.group[1]:"card"===this.group[0]&&(i.groupid=0,i.card_tag_id=this.group[1])),this.hasGroup&&this.areas&&(i.country=this.areas.country.label,"全部"===i.country&&(i.country=""),this.areas.province&&this.areas.province.show&&(i.province=this.areas.province.label,this.areas.city&&this.areas.city.show&&(i.city=this.areas.city.label))),this.timer){var t=m.unix((new Date).getTime()/1e3+this.data.diff).format("YYYY-MM-DD")+" "+("1"===this.day?this.curTime:this.curTime2),e=m(t,"YYYY-MM-DD HH:mm")
"2"===this.day&&e.add(1,"d"),i.send_time=e.unix()}this.needVerifycode&&(i.imgcode=this.verifyCode),this.postData=i,this.data.cgiData.strategy_info?k.param=JSON.parse(this.data.cgiData.strategy_info):k.param=null,this.preCheck(i)},preCheck:function(i){if(b("info","preCheck",{msg:JSON.stringify(i)}),this.confirmStauts=0,wx.cgiData.time_send_total_left=this.data.cgiData.time_send_total_left,0===i.send_time&&wx.cgiData.mass_send_left<=0)this.$tipsErr("剩余群发次数为0")
else if(!(0<i.send_time&&wx.cgiData.time_send_total_left<=0))if(0===i.send_time&&4<=+this.data.cgiData.auditing_msg_num)this.$tipsErr("超过4条群发消息待管理员确认")
else if(0<i.send_time&&4<=+this.data.cgiData.auditing_timer_msg_num)this.$tipsErr("超过4条定时群发消息待管理员确认")
else{if(this.confirmMsg="",0===i.send_time&&0<+this.data.cgiData.auditing_msg_num)return this.confirmShow=!0,this.confirmMsg=S.sprintf('当前有%s条群发消息正在等待管理员审批。<a href="javascript:;" data-type="polo" class="js_viewqueue">查看详情</a><br>是否确认要再次群发消息？',this.data.cgiData.auditing_msg_num),void(this.confirmStauts=1)
if(0!==i.send_time&&0<+this.data.cgiData.auditing_timer_msg_num)return this.confirmShow=!0,this.confirmMsg+=S.sprintf('当前有%s条定时群发消息正在等待管理员审批。<a href="javascript:;" data-type="timer" class="js_viewqueue">查看详情</a><br>是否确认要再次设置定时群发消息？',this.data.cgiData.auditing_timer_msg_num),void(this.confirmStauts=1)
if(!this.needVerifycode||this.verifyCode){if(0<i.send_time){if("1"==this.day&&0==this.data.cgiData.time_send_today_left)return void this.$tipsErr("你今天还能定时群发0次消息")
if("2"==this.day&&0==this.data.cgiData.time_send_tomorrow_left)return void this.$tipsErr("你明天还能定时群发0次消息")
if(0==this.data.time_send_oper_left)return void this.$tipsErr("操作频率过高，请明天再试")}this.check(i)}else this.$tipsErr("请输入验证码")}},doConfirm:function(){var t=this
b("info","doConfirm",{msg:JSON.stringify(this.postData)}),l.setSum(129180,41,1).send(),this.confirmShow=!1,1===this.confirmStauts?this.check(this.postData):2===this.confirmStauts?this.safeScan?k.scan(this):this.post():3!==this.confirmStauts&&4!==this.confirmStauts||(this.confirmShow=!1,this.checkCopyright(this.postData).then(function(i){return D.check(i,t)}).then(function(i){return j(i,t)}).then(function(){t.checkSafe()}))},check:function(s){var r=this
return o(regeneratorRuntime.mark(function i(){var t,e,a
return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.checkSameMaterial(s)
case 2:return t=i.sent,i.next=5,r.checkCopyright(t)
case 5:return e=i.sent,i.next=8,D.check(e,r)
case 8:return a=i.sent,i.next=11,j(a,r)
case 11:return i.next=13,r.checkSafe()
case 13:case"end":return i.stop()}},i,r)}))()},checkSameMaterial:function(e){var a=this
return b("info","checkSameMaterial",{msg:JSON.stringify(e)}),this.sameMaterialStatus=0,new Promise(function(t,i){n.post({url:"/cgi-bin/masssend?action=check_same_material",data:{msgid:e.appmsgid},error:function(){a.sameMaterialStatus=1,t(e)}},function(i){if(i&&i.base_resp&&67017===i.base_resp.ret)return b("warn","checkSameMaterial",{msg:i.base_resp.ret}),0===a.postData.send_time?(a.sameMaterialStatus=2,a.confirmStauts=3,a.confirmMsg="你已对相同内容设置了群发，建议前往首页定时列表查看，避免重复操作。"):(a.sameMaterialStatus=3,a.confirmStauts=4,a.confirmMsg="你已对相同内容设置了定时消息，建议前往首页定时列表查看，避免重复操作。"),void(a.confirmShow=!0)
a.sameMaterialStatus=1,t(e)})})},checkCopyright:function(e){var a=this
return b("info","checkCopyright",{msg:JSON.stringify(e)}),this.submitDisabled=!0,new Promise(function(i,t){y.check(e,a,!0,i)})},checkSafe:function(){var i=JSON.parse(this.data.cgiData.strategy_info||"{}")
i.third_status=this.data.cgiData.third_status,i.bind_mail=this.data.cgiData.bind_mail,i.timer=this.timer,i.wx_protect&&i.wx_alias?(this.safeScan=!0,i.source="msgs",i.msgid=this.data.cgiData.operation_seq,i.distinguish=!0,k.param=i):this.safeScan=!1,b("info","checkSafe",{msg:JSON.stringify(i)}),this.updateConfirmMsg(),this.confirmStauts=2,this.confirmShow=!0},adSend:function(){this.adViewShow=!1,this.checkSafe()},adCancel:function(){this.adViewShow=!1,this.innerShow=!0},updateConfirmMsg:function(){var t=this,i=""
if("card"===this.group[0]){var e=""
this.groupData[2].options.forEach(function(i){i.value===t.group[1]&&(e=i.label)}),i=S.sprintf("将对%s中已关注公众号的会员群发消息。<br>",-1==this.group[1]?"全部卡券用户":"卡券分组“"+e+"”")}D.withoutADWoring?this.confirmMsg=f+i+D.withoutADWoring:this.confirmMsg=f+i+"消息开始群发后无法撤销"},resetData:function(){for(var i in x)this[i]=x[i]},post:function(){var a=this
b("info","masssend",{msg:JSON.stringify(this.postData)}),d.masssend(this.postData,function(i){a.$tipsSuc("发送成功"),b("info","masssendOk",{msg:JSON.stringify(a.postData)}),window.onbeforeunload=null,location.href=c.fullUrl("/cgi-bin/home?t=home/index")},function(i){if(i&&i.base_resp){var t=i.base_resp.ret
if(b("error","masssend",{msg:t}),"200008"==t)a.$tipsErr("请输入验证码"),a.needVerifycode=!0
else if("67010"==t)a.$tipsErr("该图文消息部分文章正文为空，无法群发，请选择其他文章或编辑完整后再尝试")
else if("1530505"==t)a.$tipsErr("请勿添加其他公众号的主页链接")
else if("1530512"==t)a.$tipsErr("链接已失效，请在手机端重新复制链接")
else if("67019"==t)a.$tipsErr("推荐语不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑")
else if("13005"==t)a.$tipsErr("今日有待投放赞助广告，你当前群发的内容不符合条件，此时群发将会导致广告违约，请继续编辑。")
else if("153012"==t)a.$tipsErr("文章已声明原创，但未设置转载类型，请设置后再群发。")
else if("230000"==t||"230001"==t||"230003"==t){"230003"==t&&a.$tipsErr("系统繁忙")
var e=""
"230000"==t?e="正在发送中":"230001"==t&&(e=a.postData.send_time?"定时发送成功":"发送成功"),a.confirmShow=!0,a.confirmStauts=3,a.confirmMsg=S.sprintf("操作确认|你5分钟内已操作发送了一条消息，该条消息%s。是否需要再次群发？",e),a.postData.ack=i.ack}else"154008"==t||"154009"==t?y.done(resp,vm):"200043"==t?a.$tipsErr("图文中包含没有关联的小程序，请删除后再群发。"):"200047"==t?a.$tipsErr("标题中不能含有特殊字符"):"67026"==t?(a.confirmShow=!0,a.confirmStauts=2,a.confirmMsg="有视频声明原创失败，群发将不带原创标识，可前往<a href='/cgi-bin/appmsg?begin=0&count=10&action=list_video&type=15' target='_blank'>素材库</a>查看详情。如确认无误，可继续群发",a.postData.video_confirm=1):"67027"==t?(a.confirmShow=!0,a.confirmStauts=2,a.confirmMsg="有视频已被他人先声明原创，将按照转载样式群发，可前往<a href='/cgi-bin/appmsg?begin=0&count=10&action=list_video&type=15' target='_blank'>素材库</a>查看详情。如确认无误，可继续群发",a.postData.video_confirm=1):"67028"==t?a.$tipsErr("视频原创校验失败，无法开启赞赏功能"):i&&i.hasnotHandle&&n.handleRet(i,{id:64462,key:4,url:"/cgi-bin/masssend",msg:"系统繁忙，请稍后尝试",showMsg:!0})
a.confirmShow||a.resetData()}})},areaChange:function(i){this.areas=i},copyRightingClose:function(){this.copyRightingShow||(this.innerShow=!0)},copyRightedClose:function(){this.copyRightedShow=!1,this.innerShow=!0},copyRightTimeout:function(){var t=this
D.check(this.postData,this).then(function(i){return j(i,t)}).then(function(){t.checkSafe(),t.copyRightedShow=!1})},setPropsData:function(i){this.data=i}},props:{canUsePublicTag:{type:Number,default:0},realnameType:{type:Number,default:0},isShow:{type:Boolean,default:!1},data:{type:Object}},watch:{isShow:function(i){this.innerShow=i},adWarnShow:function(i){this.innerShow=!i},innerShow:function(i){1==this.originalDialogShow&&0==this.innerShow||this.$emit("show-change",i)},confirmShow:function(i){i&&(this.innerShow=!i)},isDialogShow:function(i){this.$emit("dialog-change",i)},data:{handler:function(){this.minTime=m.unix(((new Date).getTime()+3e5)/1e3+this.data.diff).format("HH:mm"),this.curTime=this.minTime,console.log(this.data)},immediate:!0}},computed:{isDialogShow:function(){return this.innerShow||this.confirmShow||this.originalDialogShow||this.adWarnShow||this.adViewShow||this.copyRightingShow||this.copyRightedShow},groupData:function(){var i=[{label:"全部标签",value:-1}],t=this.data.cgiData,e=[],a=void 0
if(!t)return i
if(!0===t.has_member_card){i=i.concat([{label:"按用户标签选择",value:"group"},{label:"按卡券会员选择",value:"card"}])
var s=[{label:"全部",value:"-1"}]
t.json_cardtagpage&&(t.card_group_list=JSON.parse(t.json_cardtagpage)),t.card_group_list.datas.forEach(function(i){0===i.type&&s.push({label:i.name,value:i.id})}),i[2].options=s}else i.push({label:"按标签选择",value:"group"})
if(1===t.new_user_tag){t.group=JSON.parse(t.contact_group_list).group_info_list
for(var r=0;r<t.group.length;r++){var o=t.group[r]
2<=o.group_id&&(2===o.group_id?a={label:"星标用户",value:o.group_id}:e.push({label:o.group_name,value:o.group_id}))}e=[a].concat(e.sort(function(i,t){return i.label.localeCompare(t.name)}))}else{t.group=JSON.parse(t.contact_group_list).groups
for(var n=0;n<t.group.length;++n){var d=t.group[n]
e.push({label:d.name,value:d.id})}}return i[1].options=e,i}},data:function(){var i
return s(i={serviceType:wx.cgiData.service_type,innerShow:this.isShow,loading:!1,direct_send:0,video_confirm:0,isPreviewing:!1,hot_time_type:0,hot_time_word:"",timeConfirmShow:!1,copyRightingShow:!1,copyRightedShow:!1,copyRightingContent:"原创校验中，预计等待时间10秒",needVerifycode:!1,verifyCode:"",sameMaterialStatus:0,safeScan:!0,confirmStauts:0,adViewList:[],adViewContent:"",adViewShow:!1,adWarnContent:"",adWarnShow:!1,nick_name:wx.cgiData.nick_name,originalList:[],_orglist:"",originalAppmsgid:"",postData:{},originalDialogShow:!1},"originalList",[]),s(i,"originalAppmsgid",""),s(i,"btTxt","群发"),s(i,"submitDisabled",!1),s(i,"confirmShow",!1),s(i,"confirmMsg",""),s(i,"group",[-1]),s(i,"areas",{country:{label:"",value:-1}}),s(i,"hasGroup",!1),s(i,"timer",!1),s(i,"curTime",""),s(i,"curTime2","00:00"),s(i,"minTime",""),s(i,"sex","0"),s(i,"day","1"),s(i,"sexData",[{label:"全部性别",value:"0"},{label:"男",value:"1"},{label:"女",value:"2"}]),s(i,"dayData",[{label:"今天",value:"1"},{label:"明天",value:"2"}]),i}})})
define("pages/modules/media_dialog/mass_send_dialog/mass_send_dialog.css.js", [], function (require, exports, module){module.exports = "@grid BreakPoints: {  xs: 0;  sm: 576px;  md: 768px;  lg: 992px;  xl: 1200px;}@container MaxWidths: {  xs: auto;  sm: 540px;  md: 720px;  lg: 960px;  xl: 1140px;}/*How to usefont-family: 'wechatnum';*/.mass-send {  padding: 0 30px 36px;  display: -ms-flexbox;  display: flex;  min-height: 490px;  box-sizing: border-box;  position: relative;}.mass-send .weui-desktop-dropdowncascade-menu {  overflow: hidden;  width: -webkit-fit-content;  width: fit-content;  width: -moz-fit-content;}.mass-send__list {  width: 455px;  padding-right: 40px;  border-right: 1px solid var(--weuiDesktop_separateColor);  -ms-flex-negative: 0;      flex-shrink: 0;  max-height: 480px;  overflow: auto;}.mass-send__list .weui-desktop-table {  width: 100%;  table-layout: fixed;}.mass-send__list th.ta-c,.mass-send__list td.ta-c {  text-align: center;}.mass-send__list th.ta-c:last-child,.mass-send__list td.ta-c:last-child {  text-align: center;}.mass-send__item-title {  overflow: hidden;  text-overflow: ellipsis;  display: -webkit-box;  -webkit-line-clamp: 2;  -webkit-box-orient: vertical;}.mass-send__icon-check {  display: inline-block;  vertical-align: middle;  width: 18px;  height: 13px;  background-size: cover;  background-image: url(\"data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='13' viewBox='0 0 18 13'%3E  %3Cpath fill='%2307C160' fill-rule='evenodd' d='M.696 7.747C.312 7.349.266 6.664.59 6.224l-.204.278a.977.977 0 0 1 1.381-.194L4.98 8.77c.438.335 1.141.316 1.566-.038L16.252.645c.428-.356 1.093-.33 1.482.054l-.442-.436a.976.976 0 0 1-.002 1.398L6.48 12.301a.987.987 0 0 1-1.406-.022L.696 7.747z'/%3E%3C/svg%3E\");}.mass-send__icon-null {  display: inline-block;  vertical-align: middle;  width: 12px;  height: 1px;  background-color: var(--weuiDesktop_separateColor);}.mass-send__tips {  color: var(--weuiDesktop_FG_Text_descColor);}.mass-send__form {  padding-left: 40px;}.mass-send__form .weui-desktop-form__label {  margin-right: 25px;}.mass-send__form .weui-desktop-form__dropdowncascade {  width: 100%;}.mass-send__form .weui-desktop-form__dropdown {  width: 100%;}.mass-send__form .weui-desktop-form__dropdown__dt.weui-desktop-form__dropdown__inner-button {  border-color: var(--weuiDesktop_separateColor);  padding: 4.5px 36px 4.5px 15px;}.mass-send__timer-wrp {  margin-top: 5px;}.mass-send__timer {  display: -ms-flexbox;  display: flex;  margin-top: 10px;}.mass-send__timer .weui-desktop-picker__time {  margin-left: 5px;}.mass-send__timer .weui-desktop-form__dropdown {  width: 100px;}.mass-send__timer .weui-desktop-form__dropdown__dt.weui-desktop-form__dropdown__inner-button {  min-width: 0;}.mass-send__footer {  position: relative;}.mass-send__footer .weui-desktop-popover {  opacity: 1;  visibility: visible;}.multi-sent__notice {  -ms-transform: translateY(-50%);      transform: translateY(-50%);  position: absolute;  top: 50%;  color: var(--weuiDesktop_FG_Text_descColor);}.multi-sent__notice span {  color: var(--weuiDesktop_themeColor);  margin: 0 5px;}.mass-send__group-setting {  margin: 10px 0;  font-size: 0;}.mass-send__group-setting > div {  font-size: var(--weuiDesktop_globalFontSize);  margin-bottom: 10px;}.mass-send__confirm {  position: absolute;  left: 0;  right: 0;  top: 0;  bottom: 0;  background-color: var(--weuiDesktop_cardBgColor);  display: -ms-flexbox;  display: flex;}.mass-send__confirm .weui-desktop-msg {  margin: auto;}.mass_send_loading_dialog .weui-desktop-dialog__bd {  min-height: 300px;  padding-top: 100px;}.mass_send_loading_dialog .weui-desktop-progress {  width: 50%;  margin: 30px auto;}.mass_send_loading_dialog .weui-desktop-progress .weui-desktop-progress__current {  width: 0%;  transition-property: width;  transition-duration: 1s;  transition-timing-function: linear;}";});define("pages/modules/verify_code/verify_code.js",["pages/modules/verify_code/verify_code.tpl.js","vue-weui/src/input/input.js","vue-weui/src/form/form.js","vue-weui/src/form/form_item.js","pages/modules/verify_code/verify_code.css.js"],function(e,r,o){"use strict"
var i=e("pages/modules/verify_code/verify_code.tpl.js")
e("vue-weui/src/input/input.js"),e("vue-weui/src/form/form.js"),e("vue-weui/src/form/form_item.js"),e("pages/modules/verify_code/verify_code.css.js")
Vue.component("mp-verify-code",{template:i,name:"mp-verify-code",model:{prop:"code",event:"input"},props:{name:String,code:{type:String,require:!0,default:""},required:{type:Boolean,default:!1}},data:function(){return{internalCode:this.code||"",random:Date.now(),internalStatus:"normal",codeRules:[{required:!0,message:"请输入验证码",trigger:"blur"}]}},watch:{code:function(e){this.internalCode=e},internalCode:function(e){this.$emit("input",e)}},computed:{verifyImg:function(){return"/cgi-bin/verifycode?r="+this.random}},methods:{onClickRefresh:function(){this.random=Date.now()}}})})
define("pages/modules/verify_code/verify_code.tpl.js",[],function(e,i,r){return'<mp-form-item class="verify-code__area" :prop="name" :rules="codeRules">  <span slot="label">验证码</span>\t<mp-input v-model.trim="internalCode" :clearable="true" filter="trim" autocomplete="off">\t</mp-input>\t<div class="verify-code__wrp">\t  <img :src="verifyImg" @click="onClickRefresh">\t  <a href="javascript:;" class="weui-desktop-link" @click="onClickRefresh">换一张</a>\t</div></mp-form-item>'})
define("pages/modules/verify_code/verify_code.css.js", [], function (require, exports, module){module.exports = ".verify-code__wrp {  margin-top: 10px;}.verify-code__wrp img,.verify-code__wrp a {  vertical-align: middle;}";});